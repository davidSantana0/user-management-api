Perfeito! Agora dÃ¡ pra montar uma **documentaÃ§Ã£o completa e detalhada**, explicando desde setup atÃ© endpoints, DTOs, models, middleware, Docker e autenticaÃ§Ã£o. Vou escrever como um `README.md` pronto para o seu GitHub, explicando tudo passo a passo.

---

# Gerenciamento de UsuÃ¡rios API

Uma API completa para gerenciamento de usuÃ¡rios com autenticaÃ§Ã£o JWT, criaÃ§Ã£o de administradores, controle de acesso, validaÃ§Ãµes, Docker e TypeScript.

---

## ğŸ”¹ Tecnologias usadas

* **Node.js 20** + **TypeScript**
* **Express.js** â€“ framework HTTP
* **MongoDB** â€“ banco de dados
* **Mongoose** â€“ ORM para MongoDB
* **bcrypt** â€“ hash de senhas
* **JWT (JSON Web Tokens)** â€“ autenticaÃ§Ã£o
* **Docker** â€“ containerizaÃ§Ã£o
* **ESLint/Prettier** â€“ boas prÃ¡ticas de cÃ³digo

---

## ğŸ”¹ Estrutura do projeto

```text
src/
â”œâ”€ @types/          # Tipos customizados (TypeScript)
â”œâ”€ auth/            # FunÃ§Ãµes de autenticaÃ§Ã£o e JWT
â”œâ”€ constants/       # Mensagens e constantes
â”œâ”€ controllers/     # Recebem requisiÃ§Ãµes HTTP e chamam services
â”œâ”€ database/
â”‚  â””â”€ models/       # Models do Mongoose
â”œâ”€ dtos/            # DTOs (Data Transfer Objects) para validaÃ§Ã£o e tipagem
â”œâ”€ errors/          # Tratamento de erros customizados
â”œâ”€ middleware/      # Middlewares de autenticaÃ§Ã£o, validaÃ§Ã£o e permissÃµes
â”œâ”€ routes/          # Rotas da aplicaÃ§Ã£o
â”œâ”€ services/        # LÃ³gica de negÃ³cio e manipulaÃ§Ã£o de dados
â”œâ”€ types/           # Tipos TypeScript compartilhados
â”œâ”€ utils/           # FunÃ§Ãµes utilitÃ¡rias (hash de senha etc.)
â”œâ”€ app.ts           # ConfiguraÃ§Ã£o do Express
â”œâ”€ route.ts         # ConfiguraÃ§Ã£o das rotas globais
â”œâ”€ server.ts        # InicializaÃ§Ã£o do servidor
â”œâ”€ Dockerfile       # ConfiguraÃ§Ã£o do container
â””â”€ .env             # VariÃ¡veis de ambiente
```

---

## ğŸ”¹ Setup do projeto

### 1ï¸âƒ£ Clonar repositÃ³rio

```bash
git clone <seu-repositorio>
cd <nome-do-projeto>
```

### 2ï¸âƒ£ Instalar dependÃªncias

```bash
npm install
```

### 3ï¸âƒ£ Configurar variÃ¡veis de ambiente

Crie um arquivo `.env` com as seguintes variÃ¡veis:

```env
PORT=3000

DB_PASSWORD="superSenh4$ecr3ta"
DB_USER="admin13"
MONGODB_URL="mongodb+srv://admin13:superSenh4$ecr3ta@gerenciamento-de-usuari.idezne1.mongodb.net/?appName=Gerenciamento-de-usuarios"

JWT_SECRET="8fK2xP9vQ4mL7sT1yZ0aB3cD6eH9jK2"
```

> âš ï¸ Nunca comite o `.env` em repositÃ³rios pÃºblicos.

### 4ï¸âƒ£ Rodando localmente

```bash
npm run build
npm run start
```

O servidor estarÃ¡ disponÃ­vel em `http://localhost:3000`.

### 5ï¸âƒ£ Rodando via Docker

```bash
docker build -t gerenciamento-usuarios .
docker run -p 3000:3000 gerenciamento-usuarios
```

---

## ğŸ”¹ Endpoints

### AutenticaÃ§Ã£o & Admin

| MÃ©todo | Rota        | Protegido | DescriÃ§Ã£o                         |
| ------ | ----------- | --------- | --------------------------------- |
| POST   | /auth/login | âŒ         | Login do usuÃ¡rio e retorno do JWT |
| POST   | /auth/admin | âœ… Admin   | CriaÃ§Ã£o de um novo administrador  |
| GET    | /auth/me    | âœ…         | Retorna dados do usuÃ¡rio logado   |

### UsuÃ¡rios

| MÃ©todo | Rota      | Protegido | DescriÃ§Ã£o                                   |
| ------ | --------- | --------- | ------------------------------------------- |
| POST   | /user     | âŒ         | Criar usuÃ¡rio                               |
| GET    | /user     | âŒ         | Listar todos os usuÃ¡rios                    |
| GET    | /user/:id | âŒ         | Buscar usuÃ¡rio por ID                       |
| PUT    | /user/:id | âœ…         | Atualizar usuÃ¡rio (Admin ou dono do perfil) |
| DELETE | /user/:id | âœ… Admin   | Deletar usuÃ¡rio                             |

---

## ğŸ”¹ DTOs (Data Transfer Objects)

**CreateUserDto**

```ts
interface CreateUserDto {
  name: string;
  email: string;
  password: string;
  role?: "USER" | "ADMIN";
}
```

**UserResponseDto**

```ts
interface UserResponseDto {
  id: string;
  name: string;
  email: string;
  role: "USER" | "ADMIN";
  createdAt: Date;
  UpdateAt?: Date;
}
```

---

## ğŸ”¹ Models

**User**

```ts
{
  name: string;
  email: string;
  password: string;
  role: "USER" | "ADMIN";
  createdAt: Date;
  updatedAt: Date;
}
```

* `email` deve ser Ãºnico.
* `role` padrÃ£o Ã© `USER`.
* Campos `createdAt` e `updatedAt` gerados automaticamente.

---

## ğŸ”¹ Middleware

* **authMiddleware** â€“ verifica JWT e adiciona `req.user`.
* **isAdmin** â€“ permite apenas usuÃ¡rios com role `ADMIN`.
* **emptyFields** â€“ valida preenchimento de campos obrigatÃ³rios.
* **checkObjectId** â€“ valida IDs do MongoDB.
* **errorMiddleware** â€“ captura erros e retorna JSON com detalhes.

---

## ğŸ”¹ Services

Cada controller chama um service que faz a lÃ³gica de negÃ³cio:

* **CreateUserService** â€“ cria usuÃ¡rios.
* **CreateAdminService** â€“ cria administradores (verifica permissÃ£o).
* **LoginService** â€“ valida login e retorna JWT.
* **SearchUserService** â€“ lista todos os usuÃ¡rios.
* **UpdateUserService** â€“ atualiza nome/email (verifica permissÃ£o).
* **DeleteUserService** â€“ remove usuÃ¡rios (Admin).
* **UserByIdService** â€“ busca usuÃ¡rio pelo ID.

---

## ğŸ”¹ Exemplo de uso com Postman / Insomnia

### 1ï¸âƒ£ Criar usuÃ¡rio

**POST** `/user`

```json
{
  "name": "JoÃ£o",
  "email": "joao@example.com",
  "password": "123456"
}
```

### 2ï¸âƒ£ Login

**POST** `/auth/login`

```json
{
  "email": "joao@example.com",
  "password": "123456"
}
```

**Resposta**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsIn..."
}
```

### 3ï¸âƒ£ Criar Admin

**POST** `/auth/admin`
**Headers**

```
Authorization: Bearer <JWT do admin>
```

**Body**

```json
{
  "name": "Admin2",
  "email": "admin2@example.com",
  "password": "superSenha",
  "role": "ADMIN"
}
```

### 4ï¸âƒ£ Atualizar usuÃ¡rio

**PUT** `/user/<id>`
**Headers**

```
Authorization: Bearer <JWT>
```

**Body**

```json
{
  "name": "JoÃ£o Atualizado",
  "email": "novoemail@example.com"
}
```

---

##  Hash de Senhas

* Senhas sÃ£o sempre **hashadas** com bcrypt antes de salvar no banco.
* ComparaÃ§Ã£o segura no login.

---

##  JWT

* Todos os endpoints protegidos requerem JWT no header `Authorization: Bearer <token>`.
* Payload do token:

```ts
{
  sub: string, // user ID
  role: "USER" | "ADMIN",
  iat: number,
  exp: number
}
```

---

##  Boas prÃ¡ticas & seguranÃ§a

* Senhas nunca armazenadas em texto.
* VerificaÃ§Ã£o de permissÃµes por middleware.
* Erros tratados com `AppError` e `errorMiddleware`.
* Rotas crÃ­ticas protegidas por `isAdmin`.
* IDs validados com `checkObjectId`.

---

##  Docker

1. Build:

```bash
docker build -t gerenciamento-usuarios .
```

2. Run:

```bash
docker run -p 3000:3000 gerenciamento-usuarios
```

* Porta 3000 exposta no host.
* Ambiente configurado via `.env`.

---

##  ConclusÃ£o

Esta API fornece uma base sÃ³lida para gerenciamento de usuÃ¡rios com:

* CRUD completo
* AutenticaÃ§Ã£o JWT
* Controle de permissÃµes
* Docker para deploy rÃ¡pido
* Boas prÃ¡ticas de TypeScript e Mongoose

> Pode ser expandida com features como reset de senha, logs de atividades, paginaÃ§Ã£o de usuÃ¡rios, etc.

